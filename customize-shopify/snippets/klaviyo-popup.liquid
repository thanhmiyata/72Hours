<div id="klaviyo-popup" style="display:none; position:fixed; top:0; left:0; width:100%; height:100%; background:rgba(0,0,0,0.5); z-index:9999;">
  <div style="position:absolute; top:50%; left:50%; transform:translate(-50%,-50%); background:white; padding:20px; border-radius:8px; max-width:500px; width:90%;">
    <button id="close-btn" style="position:absolute; top:10px; right:10px; background:#f44336; color:white; border:none; width:30px; height:30px; border-radius:50%; cursor:pointer; font-size:16px; font-weight:bold; z-index:10000;">âœ•</button>
    <div class="klaviyo-form-{{ form_id | default: 'RtZEP2' }}"></div>
  </div>
</div>

<script>
function closePopup() {
  var popup = document.getElementById('klaviyo-popup');
  if (popup) {
    popup.style.display='none';
  }
  sessionStorage.setItem('klaviyo_popup_closed', '1');
}

function showPopup() {
  if(!sessionStorage.getItem('klaviyo_popup_closed')){
    var popup = document.getElementById('klaviyo-popup');
    if (popup) {
      popup.style.display='block';
      var closeBtn = document.getElementById('close-btn');
      if (closeBtn) {
        closeBtn.onclick = function() { closePopup(); };
      }
      popup.onclick = function(e) {
        if(e.target === this) {
          closePopup();
        }
      };
    }
  }
}

// Wait for Klaviyo script to load before showing popup
function waitForKlaviyo() {
  var klaviyoForm = document.querySelector('.klaviyo-form-{{ form_id | default: 'RtZEP2' }}');
  if (klaviyoForm && klaviyoForm.children.length > 0) {
    // Klaviyo form has loaded, show popup
    showPopup();
  } else {
    // Check again in 100ms
    setTimeout(waitForKlaviyo, 100);
  }
}

var delay = (typeof window !== 'undefined' && typeof window.__klaviyoPopupDelay === 'number') ? window.__klaviyoPopupDelay : 3000;

setTimeout(function(){
  waitForKlaviyo();
}, delay);
</script>
